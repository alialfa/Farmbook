var Chat;(function(n){var t=function(){function n(){var n=this;this.altRow=!1,$(".chatWindow").hide(),$(".signinButton").click(function(){n.chatConnection=$.connection.chatHub,$.connection.hub.start().done(function(){$(".signin").hide(),$(".chatWindow").show(),n.chatConnection.server.registerChatClient($("#userNameTextbox").val()).done(function(){$(".chatContents > div:not(.chatHeader)").remove(),$.ajax({url:"api/messages"}).done(function(t){for(var i=t.Messages.length-1;i>=0;i--)n.PaintMsg(t.Messages[i]);$.each(t.UsersSigned,function(t,i){n.AddUser(i)})}).fail(function(){alert("something went wrong retrieving older messages")})})}).fail(function(){alert("something went wrong connecting")}),n.chatConnection.client.messageSent=n.PaintMsg,n.chatConnection.client.userSignedIn=n.AddUser,n.chatConnection.client.userSignedOut=n.RemoveUser}),$(".sendmessageButton").click(function(){n.chatConnection.server.sendText($("#userNameTextbox").val(),$("#chatMessageTextbox").val())}),$(".signoutButton").click(function(){$.connection.hub.stop(),$(".signin").show(),$(".chatWindow").hide()})}return n.prototype.PaintMsg=function(n){var i=this,u=new Date(Date.parse(n.TimeSent)),r="chatRow",t;i.altRow&&(r="altChatRow"),t="<div class='row-fluid "+r+"'>",t+="<div class='span1'>",t+=n.Username,t+="<\/div>",t+="<div class='span7'>",t+=n.MessageText,t+="<\/div>",t+="<div class='span2'>",t+=u.toLocaleTimeString(),t+="<\/div>",t+="<\/div>",$(".chatHeader").after(t),i.altRow=!i.altRow},n.prototype.AddUser=function(n){var i=this,t;$(".usersContainer > div:contains('"+n.Username+"')").length==0&&(t="<div>"+n.Username+"<\/div>",$(".usersContainer").append(t))},n.prototype.RemoveUser=function(n){$.each($(".usersContainer > div"),function(t,i){var r=$(i);r.text()==n&&r.fadeOut(500,function(){r.remove()})})},n}();n.ChatController=t})(Chat||(Chat={}))